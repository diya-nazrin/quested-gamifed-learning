<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuestEd | Python Map</title>
    <link rel="stylesheet" href="python-level.css">
</head>

<body>

    <nav class="game-nav">
        <button class="nav-btn" onclick="location.href='skillselection.html'">ğŸ  Home</button>
        <button class="nav-btn active">ğŸ—ºï¸ Map</button>
        <button class="nav-btn" onclick="location.href='profile.html'">ğŸ‘¤ Profile</button>
    </nav>

    <div class="full-screen-map">

        <div class="parchment-container">
            <h1>Python: Quest Map</h1>
            <div id="allCompleteBanner" class="all-complete" style="display:none;">
                ğŸ† All Levels Completed!
            </div>
        </div>

        <!-- lvl1 -->
        <div class="waypoint current" id="lvl1" data-href="q1info.html" style="top: 80%; left: 12%;">
            <div class="pin"></div>
            <span class="label">Level 1</span>
        </div>

        <!--lvl2-->
        <div class="waypoint locked" id="lvl2" data-href="q2info.html" style="top: 78%; left: 35%;">
            <div class="pin"></div>
            <span class="label">Level 2</span>
        </div>

        <!-- lvl3 -->
        <div class="waypoint locked" id="lvl3" data-href="q3info.html" style="top: 54%; left: 50%;">
            <div class="pin"></div>
            <span class="label">Level 3</span>
        </div>

        <!-- lvl4 -->
        <div class="waypoint locked" id="lvl4" data-href="q4info.html" style="top: 48%; left: 75%;">
            <div class="pin"></div>
            <span class="label">Level 4</span>
        </div>

        <!-- lvl5 -->
        <div class="waypoint locked" id="lvl5" data-href="q5info.html" style="top: 25%; left: 90%;">
            <div class="pin"></div>
            <span class="label">Level 5</span>
        </div>

    </div>


    <script>


        const q1Done = localStorage.getItem("q1Complete") === "1";

        const q2Done = localStorage.getItem("q2Complete") === "1";
        const q3Done = localStorage.getItem("q3Complete") === "1";
        const q4Done = localStorage.getItem("q4Complete") === "1";
        const q5Done = localStorage.getItem("q5Complete") === "1";

        function makeClickable(el) {
            el.classList.remove("locked");
            el.onclick = () => {
                const href = el.dataset.href;
                if (href) location.href = href;
            };
        }

        function lock(el) {
            el.classList.add("locked");
            el.onclick = () => {
                alert("ğŸ”’ Complete the previous level first!");
            };
        }

        function markCompleted(el) {
            el.classList.add("completed");
            el.classList.remove("current");
        }

        function unlockWithAnim(el) {
            el.classList.remove("locked");
            el.classList.add("unlocking");
            setTimeout(() => el.classList.remove("unlocking"), 700);
            makeClickable(el);
        }

        function setCurrent(el) {
            el.classList.add("current");
            el.classList.remove("locked");
        }

        const lvl1 = document.getElementById("lvl1");
        const lvl2 = document.getElementById("lvl2");
        const lvl3 = document.getElementById("lvl3");
        const lvl4 = document.getElementById("lvl4");
        const lvl5 = document.getElementById("lvl5");

        // Level 1 always clickable
        makeClickable(lvl1);

        // Completed styling
        if (q1Done) markCompleted(lvl1);
        if (q2Done) markCompleted(lvl2);
        if (q3Done) markCompleted(lvl3);
        if (q4Done) markCompleted(lvl4);
        if (q5Done) markCompleted(lvl5);

        //  Unlock order:
        // lvl2 unlock if q1Done
        // lvl3 unlock if q2Done
        // lvl4 unlock if q3Done
        // lvl5 unlock if q4Done

        if (q1Done) unlockWithAnim(lvl2); else lock(lvl2);
        if (q2Done) unlockWithAnim(lvl3); else lock(lvl3);
        if (q3Done) unlockWithAnim(lvl4); else lock(lvl4);
        if (q4Done) unlockWithAnim(lvl5); else lock(lvl5);

        // Set CURRENT level as first incomplete
        // If level1 not done -> current on lvl1 (already)
        // else current becomes first locked/uncompleted unlocked one
        function setCurrentLevel() {
            // clear old current
            [lvl1, lvl2, lvl3, lvl4, lvl5].forEach(el => el.classList.remove("current"));

            if (!q1Done) return setCurrent(lvl1);
            if (!q2Done) return setCurrent(lvl2);
            if (!q3Done) return setCurrent(lvl3);
            if (!q4Done) return setCurrent(lvl4);
            if (!q5Done) return setCurrent(lvl5);

            // all complete
            document.getElementById("allCompleteBanner").style.display = "block";
        }

        setCurrentLevel();
    </script>

</body>

</html>